<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寝室规则怪谈</title>
    <style>
/* Main Styles */
body {
    font-family: "Microsoft YaHei", Arial, sans-serif;
    max-width: 1200px;
    margin: 0 auto;
    padding: 10px;
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    line-height: 1.6;
    color: #333;
}

h1 {
    color: white;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    margin-bottom: 15px;
    font-size: 2em;
}

.main-container {
    display: flex;
    gap: 15px;
}

.game-area {
    flex: 1;
    min-width: 0;
}

#game-container {
    /* Container styles will be inherited from components */
}

/* Import component styles */






/* Responsive Design */
@media (max-width: 768px) {
    .main-container {
        flex-direction: column;
    }
    .rules-container {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 10px;
    }
    .game-area {
        order: 2;
    }
}

@media (max-width: 480px) {
    body {
        padding: 5px;
    }
    .main-container {
        gap: 10px;
    }
    .rules-container {
        flex-direction: column;
    }
    h1 {
        font-size: 1.8em;
        margin-bottom: 10px;
    }
}

.rule-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    gap: 10px;
}

.nav-button {
    background: #8b4513;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 14px;
}

.nav-button:hover {
    background: #a0522d;
}

@media (max-width: 480px) {
    .nav-button {
        padding: 6px 10px;
        font-size: 12px;
    }
}

.rule-paper {
    background: #f5f5dc;
    border: 1px solid #d2b48c;
    border-radius: 10px;
    padding: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    position: relative;
}

.rule-paper::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 30px;
    background: linear-gradient(to bottom, #e6e2d3, transparent);
    border-radius: 10px 10px 0 0;
}

.rule-title {
    font-weight: bold;
    text-align: center;
    margin-bottom: 10px;
    color: #8b4513;
    position: relative;
    z-index: 1;
}

.rule-item {
    margin: 8px 0;
    padding: 8px;
    border-bottom: 1px dashed #d2b48c;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.rule-marking-inline {
    display: flex;
    gap: 5px;
    margin-top: 5px;
}

.mark-button-inline {
    background: #d2b48c;
    color: #8b4513;
    border: none;
    border-radius: 3px;
    padding: 3px 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: bold;
    flex: 1;
    text-align: center;
}

.mark-button-inline:hover {
    background: #e6d2b5;
}

@media (max-width: 480px) {
    .rule-paper {
        padding: 10px;
    }
    .rule-item {
        margin: 6px 0;
        padding: 4px;
    }
}

.game-header {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 15px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.time-display {
    text-align: center;
    font-size: 1.1em;
    font-weight: bold;
    color: #fff;
    background: rgba(0, 0, 0, 0.3);
    padding: 8px;
    border-radius: 8px;
    margin-bottom: 12px;
}

.stats-container {
    display: flex;
    justify-content: space-around;
    text-align: center;
    margin-bottom: 15px;
    flex-wrap: wrap;
    gap: 8px;
}

.stat-item {
    background: rgba(255, 255, 255, 0.7);
    padding: 8px;
    border-radius: 8px;
    min-width: 70px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    flex: 1 1 auto;
}

.stat-value {
    font-size: 1.2em;
    font-weight: bold;
    color: #667eea;
}

.progress-bar {
    height: 8px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    overflow: hidden;
    margin: 5px 0;
}

.progress-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.3s ease;
}

.hunger-fill { 
    background: linear-gradient(90deg, #ff6b6b, #ee5a24); 
    width: 80%; 
}

.energy-fill { 
    background: linear-gradient(90deg, #4cd137, #44bd32); 
    width: 70%; 
}

.sanity-fill { 
    background: linear-gradient(90deg, #9c88ff, #8c7ae6); 
    width: 60%; 
}

.intelligence-fill { 
    background: linear-gradient(90deg, #3498db, #2980b9); 
    width: 50%; 
}

.strength-fill { 
    background: linear-gradient(90deg, #e74c3c, #c0392b); 
    width: 50%; 
}

.speed-fill { 
    background: linear-gradient(90deg, #f1c40f, #f39c12); 
    width: 50%; 
}

.luck-fill { 
    background: linear-gradient(90deg, #9b59b6, #8e44ad); 
    width: 50%; 
}

@media (max-width: 768px) {
    .stats-container {
        gap: 6px;
    }
    .stat-item {
        padding: 6px;
        min-width: 65px;
    }
}

@media (max-width: 480px) {
    .stats-container {
        gap: 4px;
    }
    .stat-item {
        padding: 5px;
        min-width: 55px;
    }
    .time-display {
        font-size: 1em;
        padding: 6px;
    }
    .stat-value {
        font-size: 1em;
    }
}

.passage {
    background: rgba(255, 255, 255, 0.95);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    margin-bottom: 15px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    min-height: 150px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.passage-text {
    font-size: 1.1em;
    line-height: 1.7;
    margin-bottom: 20px;
}

@media (max-width: 480px) {
    .passage {
        padding: 15px;
        min-height: 120px;
    }
}

.choices {
    background: rgba(255, 255, 255, 0.9);
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.choice-title {
    font-weight: bold;
    margin-bottom: 15px;
    color: #667eea;
    text-align: center;
    font-size: 1.1em;
}

button {
    display: block;
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    background: linear-gradient(45deg, #667eea, #764ba2);
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    background: linear-gradient(45deg, #764ba2, #667eea);
}

@media (max-width: 480px) {
    .choices {
        padding: 12px;
    }
    button {
        padding: 10px;
        font-size: 14px;
        margin: 6px 0;
    }
}


</style>
</head>
<body>
    <h1>寝室规则怪谈</h1>
    <div class="main-container">
        <!-- Rules Panel Component -->
        <div class="rules-container">
            <!-- Rule Navigation Component -->
            <div class="rule-navigation">
    <button class="nav-button" onclick="prevRule()">↑ 上一张</button>
    <button class="nav-button" onclick="nextRule()">下一张 ↓</button>
</div>
            
            <!-- Rule Paper Component -->
            <div class="rule-paper" id="current-rule">
    <div class="rule-title" id="current-rule-title">寝室规则</div>
    <div class="rule-item" id="current-rule-item">
    </div>
</div>
        </div>
        
        <!-- Game Area Component -->
        <div class="game-area">
            <div id="game-container">
                <!-- Game Header Component -->
                <div class="game-header">
    <div class="time-display" id="time-display">22:00</div>
    <div class="stats-container">
        <div class="stat-item">
            <div>饱食度</div>
            <div class="stat-value" id="hunger-value">80</div>
            <div class="progress-bar">
                <div class="progress-fill hunger-fill" style="width: 80%;"></div>
            </div>
        </div>
        <div class="stat-item">
            <div>体力</div>
            <div class="stat-value" id="energy-value">70</div>
            <div class="progress-bar">
                <div class="progress-fill energy-fill" style="width: 70%;"></div>
            </div>
        </div>
        <div class="stat-item">
            <div>理智值</div>
            <div class="stat-value" id="sanity-value">60</div>
            <div class="progress-bar">
                <div class="progress-fill sanity-fill" style="width: 60%;"></div>
            </div>
        </div>
        <div class="stat-item">
            <div>智力</div>
            <div class="stat-value" id="intelligence-value">50</div>
            <div class="progress-bar">
                <div class="progress-fill intelligence-fill" style="width: 50%;"></div>
            </div>
        </div>
        <div class="stat-item">
            <div>力量</div>
            <div class="stat-value" id="strength-value">50</div>
            <div class="progress-bar">
                <div class="progress-fill strength-fill" style="width: 50%;"></div>
            </div>
        </div>
        <div class="stat-item">
            <div>速度</div>
            <div class="stat-value" id="speed-value">50</div>
            <div class="progress-bar">
                <div class="progress-fill speed-fill" style="width: 50%;"></div>
            </div>
        </div>
        <div class="stat-item">
            <div>运气</div>
            <div class="stat-value" id="luck-value">50</div>
            <div class="progress-bar">
                <div class="progress-fill luck-fill" style="width: 50%;"></div>
            </div>
        </div>
    </div>
</div>
                
                <!-- Passage Component -->
                <div id="passage" class="passage">
    <div class="passage-text">
        <p>欢迎来到寝室规则怪谈！</p>
        <p>你是一个刚入学的新生，现在是晚上10点，你独自在寝室里。墙上贴着一些奇怪的规则纸条，你需要小心遵守它们。</p>
    </div>
</div>
                
                <!-- Choices Component -->
                <div id="choices" class="choices">
    <div class="choice-title">请选择你的行动：</div>
    <button onclick="goToPassage('checkRules', 0.25, 0, -5, -10, 5, 0, 0, 0)">仔细查看规则纸条</button>
    <button onclick="goToPassage('goToBed', 0.5, 0, -10, 5, 0, 5, 0, 0)">准备睡觉</button>
    <button onclick="goToPassage('leaveRoom', 1, -5, -15, -20, 0, 0, -5, 0)">离开寝室去图书馆</button>
</div>
            </div>
        </div>
    </div>

    <script>
// Game state
const gameState = {
    time: 22, // 22:00 (10 PM)
    hunger: 80,
    energy: 70,
    sanity: 60,
    intelligence: 50,
    strength: 50,
    speed: 50,
    luck: 50
};

// Game passages data
const passages = {
    start: {
        text: "欢迎来到寝室规则怪谈！你是一个刚入学的新生，现在是晚上10点，你独自在寝室里。墙上贴着一些奇怪的规则纸条，你需要小心遵守它们。",
        choices: [
            { text: "仔细查看规则纸条", action: "checkRules", timeChange: 0.25, hungerChange: 0, energyChange: -5, sanityChange: -10, intelligenceChange: 5 },
            { text: "准备睡觉", action: "goToBed", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: 5, strengthChange: 5 },
            { text: "离开寝室去图书馆", action: "leaveRoom", timeChange: 1, hungerChange: -5, energyChange: -15, sanityChange: -20, speedChange: -5 }
        ]
    },
    checkRules: {
        text: "你仔细查看了墙上的规则纸条，发现这些规则都很奇怪。有些规则看起来互相矛盾，有些规则似乎在暗示着什么可怕的事情。",
        choices: [
            { text: "研究规则之间的矛盾", action: "analyzeContradictions", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: -15, intelligenceChange: 10 },
            { text: "尝试验证某条规则", action: "testRule", timeChange: 1, hungerChange: -5, energyChange: -15, sanityChange: -20, luckChange: -10 },
            { text: "回到床铺", action: "goToBed", timeChange: 0.25, hungerChange: 0, energyChange: -5, sanityChange: 10, strengthChange: 5 }
        ]
    },
    goToBed: {
        text: "你爬上了床铺，准备睡觉。但是你注意到寝室里似乎有些不对劲...墙上的一些规则纸条在黑暗中似乎在发光。",
        choices: [
            { text: "开灯仔细查看", action: "turnOnLight", timeChange: 0.25, hungerChange: 0, energyChange: -5, sanityChange: -10, intelligenceChange: 5 },
            { text: "蒙头睡觉", action: "sleep", timeChange: 2, hungerChange: 0, energyChange: 10, sanityChange: -5, strengthChange: 10 },
            { text: "起床继续研究规则", action: "checkRules", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: -15, intelligenceChange: 5 }
        ]
    },
    leaveRoom: {
        text: "你决定离开寝室去图书馆。当你打开门时，你注意到走廊里异常安静，而且走廊的灯似乎比平时暗淡。",
        choices: [
            { text: "前往图书馆", action: "library", timeChange: 1, hungerChange: -10, energyChange: -20, sanityChange: -30, intelligenceChange: 10 },
            { text: "返回寝室", action: "start", timeChange: 0.5, hungerChange: 0, energyChange: -5, sanityChange: 15, luckChange: 5 }
        ]
    },
    analyzeContradictions: {
        text: "你发现规则纸条之间确实存在矛盾。比如一张纸条说'不要在黑暗中数床铺数量'，而另一张却说'必须每天确认床铺数量'。这让你感到非常困惑和不安。",
        choices: [
            { text: "尝试解决矛盾", action: "solveContradiction", timeChange: 1, hungerChange: -5, energyChange: -15, sanityChange: -25, intelligenceChange: 15 },
            { text: "忽略矛盾继续睡觉", action: "goToBed", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: 10, strengthChange: 5 }
        ]
    },
    testRule: {
        text: "你决定验证第一条规则：'晚上11点后不要照镜子'。现在是10:30，你拿起手电筒走向镜子。当你照镜子时，你发现镜子里的自己似乎在微笑，但你并没有笑。",
        choices: [
            { text: "立即关灯", action: "turnOffLight", timeChange: 0.1, hungerChange: 0, energyChange: -10, sanityChange: -30, speedChange: 10 },
            { text: "仔细观察镜子里的自己", action: "observeMirror", timeChange: 0.5, hungerChange: 0, energyChange: -15, sanityChange: -40, luckChange: -15 }
        ]
    },
    turnOnLight: {
        text: "你打开了灯，仔细查看墙上的规则纸条。在明亮的灯光下，你发现有些规则字迹似乎在慢慢变化，而且你确信刚才有些规则的内容和现在不一样了。你注意到墙角似乎还有一张被遮挡的纸条。",
        choices: [
            { text: "记录变化的规则", action: "documentChanges", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: -20, intelligenceChange: 10 },
            { text: "查看墙角的纸条", action: "findRule2", timeChange: 0.25, hungerChange: 0, energyChange: -5, sanityChange: -10, luckChange: 10 },
            { text: "关灯假装什么都没发生", action: "goToBed", timeChange: 0.25, hungerChange: 0, energyChange: -5, sanityChange: 15, strengthChange: 5 }
        ]
    },
    findRule2: {
        text: "你走向墙角，移开了遮挡物，发现了一张新的规则纸条！上面写着：寝室规则二。",
        choices: [
            { text: "查看规则内容", action: "checkRules", timeChange: 0.1, hungerChange: 0, energyChange: 0, sanityChange: -5, intelligenceChange: 5 },
            { text: "继续研究其他规则", action: "turnOnLight", timeChange: 0.1, hungerChange: 0, energyChange: 0, sanityChange: 5, luckChange: 5 }
        ]
    },
    sleep: {
        text: "你蒙头睡着了。在梦中，你梦见自己在数寝室里的床铺。当你数到第四张床时，你发现那张床上坐着一个你看不清面容的人...",
        choices: [
            { text: "惊醒", action: "wakeUp", timeChange: 2, hungerChange: -10, energyChange: 5, sanityChange: -25 },
            { text: "继续做梦", action: "continueDream", timeChange: 1, hungerChange: 0, energyChange: -10, sanityChange: -40 }
        ]
    },
    library: {
        text: "你来到了图书馆，但是这里空无一人。所有的书都在书架上自动翻页，发出沙沙的声音。你感到一阵寒意，意识到这里可能比寝室更危险。",
        choices: [
            { text: "寻找关于规则怪谈的书籍", action: "research", timeChange: 1, hungerChange: -15, energyChange: -20, sanityChange: -35 },
            { text: "立即返回寝室", action: "start", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: 20 }
        ]
    },
    solveContradiction: {
        text: "你试图解决规则之间的矛盾，但这让你更加困惑。每当你认为找到了答案，规则就会发生变化。你开始怀疑这些规则是活的，它们在故意玩弄你。",
        choices: [
            { text: "放弃解决矛盾", action: "giveUp", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: 10 },
            { text: "继续尝试理解", action: "keepTrying", timeChange: 1, hungerChange: -10, energyChange: -20, sanityChange: -40 }
        ]
    },
    turnOffLight: {
        text: "你立即关掉了灯，但即使在黑暗中，你仍然能感觉到有什么东西在注视着你。你听到床下传来轻微的呼吸声...",
        choices: [
            { text: "躲在被子里", action: "hideUnderCovers", timeChange: 1, hungerChange: 0, energyChange: -15, sanityChange: -35 },
            { text: "勇敢地查看床下", action: "checkUnderBed", timeChange: 0.5, hungerChange: 0, energyChange: -20, sanityChange: -50 }
        ]
    },
    observeMirror: {
        text: "你仔细观察镜子里的自己，发现镜子里的你开始做出和你不同的动作。它在笑，而你在颤抖。镜子里的你开始慢慢地举起手，指向你身后的某个地方...",
        choices: [
            { text: "转身查看身后", action: "turnAround", timeChange: 0.25, hungerChange: 0, energyChange: -15, sanityChange: -45 },
            { text: "打破镜子", action: "breakMirror", timeChange: 0.5, hungerChange: 0, energyChange: -20, sanityChange: -30 }
        ]
    },
    documentChanges: {
        text: "你试图记录下规则的变化，但你发现无论用什么方式记录，文字都会在你查看时变回原来的样子。你开始怀疑自己的记忆是否可靠。",
        choices: [
            { text: "相信自己的记忆", action: "trustMemory", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: -25 },
            { text: "质疑自己的感知", action: "doubtPerception", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: -20 }
        ]
    },
    wakeUp: {
        text: "你惊醒了，发现自己还在寝室里。但是墙上多了一张新的规则纸条，上面写着：'不要相信你刚才做的梦'。你开始分不清现实和梦境了。你注意到这张纸条旁边还有其他字迹。",
        choices: [
            { text: "查看新增的规则", action: "checkNewRule", timeChange: 0.25, hungerChange: 0, energyChange: -5, sanityChange: -30 },
            { text: "仔细查看旁边的字迹", action: "findRule3", timeChange: 0.25, hungerChange: 0, energyChange: -5, sanityChange: -15 },
            { text: "假装什么都没发生", action: "pretendNormal", timeChange: 0.5, hungerChange: 0, energyChange: -5, sanityChange: 10 }
        ]
    },
    findRule3: {
        text: "你仔细查看旁边的字迹，发现这是寝室规则三的内容，但字迹很模糊，需要仔细辨认。",
        choices: [
            { text: "努力辨认规则", action: "checkRules", timeChange: 0.1, hungerChange: 0, energyChange: -5, sanityChange: -10 },
            { text: "放弃辨认", action: "wakeUp", timeChange: 0.1, hungerChange: 0, energyChange: 0, sanityChange: 5 }
        ]
    },
    research: {
        text: "你在图书馆里寻找关于规则怪谈的资料，发现了一个可怕的真相：每个遵守规则的人最终都会成为规则的一部分，而新来的学生会发现他们的规则纸条...你在书页的角落发现了一个手写的纸条。",
        choices: [
            { text: "立即离开图书馆", action: "leaveLibrary", timeChange: 0.5, hungerChange: -10, energyChange: -15, sanityChange: -25 },
            { text: "查看手写纸条", action: "findRule4", timeChange: 0.25, hungerChange: 0, energyChange: -10, sanityChange: -20 },
            { text: "继续深入研究", action: "deepResearch", timeChange: 1, hungerChange: -20, energyChange: -25, sanityChange: -50 }
        ]
    },
    findRule4: {
        text: "你查看手写纸条，上面写着：寝室规则四。但字迹很淡，似乎随时会消失。",
        choices: [
            { text: "快速记录规则", action: "checkRules", timeChange: 0.1, hungerChange: 0, energyChange: -5, sanityChange: -15 },
            { text: "小心保存纸条", action: "research", timeChange: 0.1, hungerChange: 0, energyChange: 0, sanityChange: -5 }
        ]
    },
    giveUp: {
        text: "你决定放弃解决规则矛盾，回到床铺上。但是你发现你的床铺不见了，取而代之的是墙上多了一条新规则：'第四个室友必须在午夜前消失'。",
        choices: [
            { text: "寻找自己的床铺", action: "findBed", timeChange: 0.5, hungerChange: 0, energyChange: -15, sanityChange: -35 },
            { text: "质疑现实", action: "questionReality", timeChange: 0.5, hungerChange: 0, energyChange: -10, sanityChange: -30 }
        ]
    },
    hideUnderCovers: {
        text: "你躲在被子里，听到床下传来更多的呼吸声，似乎不止一个存在。你意识到寝室里可能还有其他你看不见的室友...",
        choices: [
            { text: "保持不动", action: "stayStill", timeChange: 1, hungerChange: 0, energyChange: -10, sanityChange: -40 },
            { text: "悄悄查看", action: "peekOut", timeChange: 0.25, hungerChange: 0, energyChange: -15, sanityChange: -45 }
        ]
    },
    checkUnderBed: {
        text: "你鼓起勇气查看床下，发现床下空无一物，但是你听到身后传来脚步声。当你转身时，看到一个模糊的身影正站在你的床边...",
        choices: [
            { text: "询问是谁", action: "askWho", timeChange: 0.25, hungerChange: 0, energyChange: -20, sanityChange: -50 },
            { text: "立即逃跑", action: "runAway", timeChange: 0.5, hungerChange: -10, energyChange: -25, sanityChange: -35 }
        ]
    }
};

// Rule papers data
const rulePapers = [
    {
        id: 1,
        title: "寝室规则一",
        found: true,
        rules: [
            { id: 1, text: "晚上11点后不要照镜子", marked: "unknown" },
            { id: 2, text: "不要在黑暗中数床铺数量", marked: "unknown" },
            { id: 3, text: "听到脚步声要立即蒙头睡觉", marked: "unknown" },
            { id: 4, text: "不要回应门外的呼唤声", marked: "unknown" },
            { id: 5, text: "熄灯后不要开手电筒", marked: "unknown" }
        ]
    },
    {
        id: 2,
        title: "寝室规则二",
        found: false,
        rules: [
            { id: 6, text: "不要穿室友的鞋子", marked: "unknown" },
            { id: 7, text: "衣柜里的衣服要按顺序摆放", marked: "unknown" },
            { id: 8, text: "不要触碰墙上的划痕", marked: "unknown" },
            { id: 9, text: "每天必须更换床单", marked: "unknown" }
        ]
    },
    {
        id: 3,
        title: "寝室规则三",
        found: false,
        rules: [
            { id: 10, text: "不要在午夜12点后上厕所", marked: "unknown" },
            { id: 11, text: "发现异常要立即告诉宿管", marked: "unknown" },
            { id: 12, text: "不要独自留在寝室超过30分钟", marked: "unknown" },
            { id: 13, text: "窗户必须在晚上10点前关闭", marked: "unknown" },
            { id: 14, text: "不要移动床位的位置", marked: "unknown" },
            { id: 15, text: "听到哭声要数到10再行动", marked: "unknown" }
        ]
    },
    {
        id: 4,
        title: "寝室规则四",
        found: false,
        rules: [
            { id: 16, text: "不要相信第4个室友说的话", marked: "unknown" },
            { id: 17, text: "发现红字要立即撕掉", marked: "unknown" },
            { id: 18, text: "不要在镜子里寻找自己", marked: "unknown" }
        ]
    }
];

// Current rule paper index
let currentPaperIndex = 0;

// Mark rule function
function markRule(ruleId, status) {
    const paper = rulePapers[currentPaperIndex];
    const rule = paper.rules.find(r => r.id === ruleId);
    if (rule) {
        rule.marked = status;
        updateRuleDisplay();
    }
}

// Find rule paper function
function findRulePaper(paperId) {
    const paper = rulePapers.find(p => p.id === paperId);
    if (paper && !paper.found) {
        paper.found = true;
        // If currently displaying this paper, update display
        if (rulePapers[currentPaperIndex].id === paperId) {
            updateRuleDisplay();
        }
        return true;
    }
    return false;
}

// Update rule display function
function updateRuleDisplay() {
    const paper = rulePapers[currentPaperIndex];
    document.getElementById('current-rule-title').textContent = paper.title;
    
    // Clear current rule display
    const ruleItem = document.getElementById('current-rule-item');
    ruleItem.innerHTML = '';
    
    // Display content based on paper state
    if (paper.found) {
        // Display all rules on this paper
        paper.rules.forEach(rule => {
            const ruleDiv = document.createElement('div');
            ruleDiv.className = 'rule-item';
            
            // Set rule text color based on marking status
            let ruleTextColor = 'black';
            if (rule.marked === 'true') {
                ruleTextColor = 'green';
            } else if (rule.marked === 'false') {
                ruleTextColor = 'red';
            }
            
            ruleDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; width: 100%; align-items: center;">
                    <span class="rule-text" style="color: ${ruleTextColor}">${rule.text}</span>
                </div>
                <div class="rule-marking-inline">
                    <button class="mark-button-inline" onclick="markRule(${rule.id}, 'true')" style="background-color: ${rule.marked === 'true' ? '#4CAF50' : '#d2b48c'}">真</button>
                    <button class="mark-button-inline" onclick="markRule(${rule.id}, 'false')" style="background-color: ${rule.marked === 'false' ? '#f44336' : '#d2b48c'}">假</button>
                    <button class="mark-button-inline" onclick="markRule(${rule.id}, 'unknown')" style="background-color: ${rule.marked === 'unknown' ? '#FF9800' : '#d2b48c'}">未知</button>
                </div>
            `;
            
            ruleItem.appendChild(ruleDiv);
        });
    } else {
        // Display "rules not found"
        const notFoundDiv = document.createElement('div');
        notFoundDiv.className = 'rule-item';
        notFoundDiv.innerHTML = '<div style="text-align: center; color: #888; font-style: italic; padding: 30px; font-size: 16px; background: rgba(136, 136, 136, 0.1); border-radius: 8px; border: 1px dashed #d2b48c;">规则未找到</div>';
        ruleItem.appendChild(notFoundDiv);
    }
}

// Previous rule function
function prevRule() {
    currentPaperIndex = (currentPaperIndex - 1 + rulePapers.length) % rulePapers.length;
    updateRuleDisplay();
}

// Next rule function
function nextRule() {
    currentPaperIndex = (currentPaperIndex + 1) % rulePapers.length;
    updateRuleDisplay();
}

// Update time display function
function updateTime() {
    const timeDisplay = document.getElementById('time-display');
    const hours = Math.floor(gameState.time);
    const minutes = Math.floor((gameState.time - hours) * 60);
    timeDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
}

// Update stats display function
function updateStats() {
    document.getElementById('hunger-value').textContent = gameState.hunger;
    document.getElementById('energy-value').textContent = gameState.energy;
    document.getElementById('sanity-value').textContent = gameState.sanity;
    document.getElementById('intelligence-value').textContent = gameState.intelligence;
    document.getElementById('strength-value').textContent = gameState.strength;
    document.getElementById('speed-value').textContent = gameState.speed;
    document.getElementById('luck-value').textContent = gameState.luck;
    
    // Update progress bar widths
    document.querySelector('.hunger-fill').style.width = gameState.hunger + '%';
    document.querySelector('.energy-fill').style.width = gameState.energy + '%';
    document.querySelector('.sanity-fill').style.width = gameState.sanity + '%';
    document.querySelector('.intelligence-fill').style.width = gameState.intelligence + '%';
    document.querySelector('.strength-fill').style.width = gameState.strength + '%';
    document.querySelector('.speed-fill').style.width = gameState.speed + '%';
    document.querySelector('.luck-fill').style.width = gameState.luck + '%';
}

// Go to passage function
function goToPassage(passageId, timeChange = 0, hungerChange = 0, energyChange = 0, sanityChange = 0, intelligenceChange = 0, strengthChange = 0, speedChange = 0, luckChange = 0) {
    // Special handling: find rule papers
    if (passageId === 'findRule2') {
        findRulePaper(2); // Find rule paper 2
    } else if (passageId === 'findRule3') {
        findRulePaper(3); // Find rule paper 3
    } else if (passageId === 'findRule4') {
        findRulePaper(4); // Find rule paper 4
    }
    
    // Update game state
    gameState.time += timeChange;
    if (gameState.time >= 24) {
        gameState.time -= 24; // 24-hour cycle
    }
    if (gameState.time < 0) {
        gameState.time += 24; // Handle negative time
    }
    
    gameState.hunger = Math.max(0, Math.min(100, gameState.hunger + hungerChange));
    gameState.energy = Math.max(0, Math.min(100, gameState.energy + energyChange));
    gameState.sanity = Math.max(0, Math.min(100, gameState.sanity + sanityChange));
    gameState.intelligence = Math.max(0, Math.min(100, gameState.intelligence + intelligenceChange));
    gameState.strength = Math.max(0, Math.min(100, gameState.strength + strengthChange));
    gameState.speed = Math.max(0, Math.min(100, gameState.speed + speedChange));
    gameState.luck = Math.max(0, Math.min(100, gameState.luck + luckChange));
    
    const passage = passages[passageId];
    if (passage) {
        // Update passage text
        document.getElementById('passage').innerHTML = '<div class="passage-text"><p>' + passage.text.replace(/\n\n/g, '</p><p>') + '</p></div>';
        
        // Clear and update choice buttons
        const choicesDiv = document.getElementById('choices');
        choicesDiv.innerHTML = '<div class="choice-title">请选择你的行动：</div>';
        
        // Add new choice buttons
        passage.choices.forEach(choice => {
            const button = document.createElement('button');
            button.textContent = choice.text;
            if (choice.actionFunction) {
                button.onclick = choice.actionFunction;
            } else {
                button.onclick = () => goToPassage(
                    choice.action, 
                    choice.timeChange || 0, 
                    choice.hungerChange || 0, 
                    choice.energyChange || 0, 
                    choice.sanityChange || 0,
                    choice.intelligenceChange || 0,
                    choice.strengthChange || 0,
                    choice.speedChange || 0,
                    choice.luckChange || 0
                );
            }
            choicesDiv.appendChild(button);
        });
        
        // Update time and stats display
        updateTime();
        updateStats();
    }
}

// Initialize game
updateTime();
updateStats();
updateRuleDisplay();
</script>
</body>
</html>